/*
 * Click nbfs://nbhost/SystemFileSystem/Templates/Licenses/license-default.txt to change this license
 * Click nbfs://nbhost/SystemFileSystem/Templates/GUIForms/JFrame.java to edit this template
 */
package Interfaz;

import static Clases.Metodos.*;
import java.awt.Color;
import java.sql.PreparedStatement;
import java.sql.ResultSet;
import java.sql.SQLException;
import java.util.logging.Level;
import java.util.logging.Logger;
import static javax.swing.JOptionPane.showMessageDialog;
import javax.swing.table.DefaultTableModel;
/**
 *
 * @author Lenovo
 */
public class Usuarios extends javax.swing.JFrame {
    
    private DefaultTableModel Tabla;
    
    public Usuarios() {
        initComponents();
        ConectarBD();
        llenarTabla("");
        btnCancelar.setVisible(false);
        btnActualizar.setVisible(false);
    }
    String nombreActualizar;
    /**
     * This method is called from within the constructor to initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is always
     * regenerated by the Form Editor.
     */
    @SuppressWarnings("unchecked")
    // <editor-fold defaultstate="collapsed" desc="Generated Code">//GEN-BEGIN:initComponents
    private void initComponents() {

        jLabel2 = new javax.swing.JLabel();
        jLabel1 = new javax.swing.JLabel();
        txtBuscar = new javax.swing.JTextField();
        btnCancelar = new javax.swing.JLabel();
        Actu1 = new javax.swing.JLabel();
        btnEliminar = new javax.swing.JLabel();
        jScrollPane1 = new javax.swing.JScrollPane();
        tblUsuario = new javax.swing.JTable();
        txtNombre = new javax.swing.JTextField();
        txtContra = new javax.swing.JTextField();
        txtRContra = new javax.swing.JTextField();
        txtTelefono = new javax.swing.JTextField();
        txtRfc = new javax.swing.JTextField();
        cmbRol = new javax.swing.JComboBox<>();
        jLabel6 = new javax.swing.JLabel();
        txtCurp = new javax.swing.JTextField();
        btnGuardar = new javax.swing.JLabel();
        btnActualizar = new javax.swing.JLabel();

        setDefaultCloseOperation(javax.swing.WindowConstants.EXIT_ON_CLOSE);
        setTitle("Usuarios");

        jLabel2.setText("Ic. Menú");

        jLabel1.setText("Ic. Buscar");
        jLabel1.addMouseListener(new java.awt.event.MouseAdapter() {
            public void mouseClicked(java.awt.event.MouseEvent evt) {
                jLabel1MouseClicked(evt);
            }
        });

        btnCancelar.setText("Ic. Cancelar");
        btnCancelar.addMouseListener(new java.awt.event.MouseAdapter() {
            public void mouseClicked(java.awt.event.MouseEvent evt) {
                btnCancelarMouseClicked(evt);
            }
        });

        Actu1.setText("Ic. Actualizar");
        Actu1.addMouseListener(new java.awt.event.MouseAdapter() {
            public void mouseClicked(java.awt.event.MouseEvent evt) {
                Actu1MouseClicked(evt);
            }
        });

        btnEliminar.setText("Ic. Eliminar");
        btnEliminar.addMouseListener(new java.awt.event.MouseAdapter() {
            public void mouseClicked(java.awt.event.MouseEvent evt) {
                btnEliminarMouseClicked(evt);
            }
        });

        tblUsuario.setModel(new javax.swing.table.DefaultTableModel(
            new Object [][] {

            },
            new String [] {
                "Nombre", "Rol", "Telefono", "RFC", "CURP"
            }
        ));
        jScrollPane1.setViewportView(tblUsuario);

        txtNombre.setFont(new java.awt.Font("Tahoma", 0, 14)); // NOI18N
        txtNombre.setForeground(java.awt.Color.gray);
        txtNombre.setText("Nombre de usuario:");
        txtNombre.addFocusListener(new java.awt.event.FocusAdapter() {
            public void focusGained(java.awt.event.FocusEvent evt) {
                txtNombreFocusGained(evt);
            }
            public void focusLost(java.awt.event.FocusEvent evt) {
                txtNombreFocusLost(evt);
            }
        });

        txtContra.setFont(new java.awt.Font("Tahoma", 0, 14)); // NOI18N
        txtContra.setForeground(java.awt.Color.gray);
        txtContra.setText("Contraseña:");
        txtContra.addFocusListener(new java.awt.event.FocusAdapter() {
            public void focusGained(java.awt.event.FocusEvent evt) {
                txtContraFocusGained(evt);
            }
            public void focusLost(java.awt.event.FocusEvent evt) {
                txtContraFocusLost(evt);
            }
        });

        txtRContra.setFont(new java.awt.Font("Tahoma", 0, 14)); // NOI18N
        txtRContra.setForeground(java.awt.Color.gray);
        txtRContra.setText("Repetir contraseña:");
        txtRContra.addFocusListener(new java.awt.event.FocusAdapter() {
            public void focusGained(java.awt.event.FocusEvent evt) {
                txtRContraFocusGained(evt);
            }
            public void focusLost(java.awt.event.FocusEvent evt) {
                txtRContraFocusLost(evt);
            }
        });

        txtTelefono.setFont(new java.awt.Font("Tahoma", 0, 14)); // NOI18N
        txtTelefono.setForeground(java.awt.Color.gray);
        txtTelefono.setText("Teléfono:");
        txtTelefono.addFocusListener(new java.awt.event.FocusAdapter() {
            public void focusGained(java.awt.event.FocusEvent evt) {
                txtTelefonoFocusGained(evt);
            }
            public void focusLost(java.awt.event.FocusEvent evt) {
                txtTelefonoFocusLost(evt);
            }
        });

        txtRfc.setFont(new java.awt.Font("Tahoma", 0, 14)); // NOI18N
        txtRfc.setForeground(java.awt.Color.gray);
        txtRfc.setText("RFC:");
        txtRfc.addFocusListener(new java.awt.event.FocusAdapter() {
            public void focusGained(java.awt.event.FocusEvent evt) {
                txtRfcFocusGained(evt);
            }
            public void focusLost(java.awt.event.FocusEvent evt) {
                txtRfcFocusLost(evt);
            }
        });

        cmbRol.setFont(new java.awt.Font("Tahoma", 0, 14)); // NOI18N
        cmbRol.setModel(new javax.swing.DefaultComboBoxModel<>(new String[] { "Seleccionar rol", "Empleado almacén", "Empleado ventas" }));

        jLabel6.setFont(new java.awt.Font("Tahoma", 0, 14)); // NOI18N
        jLabel6.setText("Formulario para registrar usuario");

        txtCurp.setFont(new java.awt.Font("Tahoma", 0, 14)); // NOI18N
        txtCurp.setForeground(java.awt.Color.gray);
        txtCurp.setText("CURP:");
        txtCurp.addFocusListener(new java.awt.event.FocusAdapter() {
            public void focusGained(java.awt.event.FocusEvent evt) {
                txtCurpFocusGained(evt);
            }
            public void focusLost(java.awt.event.FocusEvent evt) {
                txtCurpFocusLost(evt);
            }
        });

        btnGuardar.setText("Ic. Guardar");
        btnGuardar.addMouseListener(new java.awt.event.MouseAdapter() {
            public void mouseClicked(java.awt.event.MouseEvent evt) {
                btnGuardarMouseClicked(evt);
            }
        });

        btnActualizar.setText("Ic. Actualizar");
        btnActualizar.addMouseListener(new java.awt.event.MouseAdapter() {
            public void mouseClicked(java.awt.event.MouseEvent evt) {
                btnActualizarMouseClicked(evt);
            }
        });

        javax.swing.GroupLayout layout = new javax.swing.GroupLayout(getContentPane());
        getContentPane().setLayout(layout);
        layout.setHorizontalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(layout.createSequentialGroup()
                .addComponent(jLabel2, javax.swing.GroupLayout.PREFERRED_SIZE, 50, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addGap(0, 0, Short.MAX_VALUE))
            .addGroup(layout.createSequentialGroup()
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addGroup(layout.createSequentialGroup()
                        .addContainerGap()
                        .addComponent(jScrollPane1, javax.swing.GroupLayout.PREFERRED_SIZE, 380, javax.swing.GroupLayout.PREFERRED_SIZE))
                    .addGroup(layout.createSequentialGroup()
                        .addGap(44, 44, 44)
                        .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING, false)
                            .addGroup(layout.createSequentialGroup()
                                .addComponent(Actu1, javax.swing.GroupLayout.PREFERRED_SIZE, 70, javax.swing.GroupLayout.PREFERRED_SIZE)
                                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                                .addComponent(btnEliminar, javax.swing.GroupLayout.PREFERRED_SIZE, 70, javax.swing.GroupLayout.PREFERRED_SIZE))
                            .addGroup(layout.createSequentialGroup()
                                .addComponent(txtBuscar, javax.swing.GroupLayout.PREFERRED_SIZE, 200, javax.swing.GroupLayout.PREFERRED_SIZE)
                                .addGap(18, 18, 18)
                                .addComponent(jLabel1, javax.swing.GroupLayout.PREFERRED_SIZE, 60, javax.swing.GroupLayout.PREFERRED_SIZE)))))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED, 84, Short.MAX_VALUE)
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.TRAILING, false)
                    .addComponent(txtRContra, javax.swing.GroupLayout.Alignment.LEADING)
                    .addComponent(txtContra, javax.swing.GroupLayout.Alignment.LEADING)
                    .addComponent(txtTelefono, javax.swing.GroupLayout.Alignment.LEADING)
                    .addComponent(txtRfc, javax.swing.GroupLayout.Alignment.LEADING)
                    .addComponent(cmbRol, javax.swing.GroupLayout.Alignment.LEADING, 0, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                    .addComponent(txtNombre, javax.swing.GroupLayout.Alignment.LEADING)
                    .addComponent(jLabel6, javax.swing.GroupLayout.Alignment.LEADING, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                    .addComponent(txtCurp, javax.swing.GroupLayout.Alignment.LEADING)
                    .addGroup(javax.swing.GroupLayout.Alignment.LEADING, layout.createSequentialGroup()
                        .addComponent(btnCancelar, javax.swing.GroupLayout.PREFERRED_SIZE, 72, javax.swing.GroupLayout.PREFERRED_SIZE)
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                        .addComponent(btnActualizar, javax.swing.GroupLayout.PREFERRED_SIZE, 72, javax.swing.GroupLayout.PREFERRED_SIZE)
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                        .addComponent(btnGuardar, javax.swing.GroupLayout.PREFERRED_SIZE, 72, javax.swing.GroupLayout.PREFERRED_SIZE)))
                .addGap(55, 55, 55))
        );
        layout.setVerticalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(javax.swing.GroupLayout.Alignment.TRAILING, layout.createSequentialGroup()
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.TRAILING)
                    .addGroup(layout.createSequentialGroup()
                        .addComponent(jLabel2, javax.swing.GroupLayout.PREFERRED_SIZE, 50, javax.swing.GroupLayout.PREFERRED_SIZE)
                        .addGap(18, 18, 18)
                        .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                            .addComponent(txtBuscar, javax.swing.GroupLayout.PREFERRED_SIZE, 30, javax.swing.GroupLayout.PREFERRED_SIZE)
                            .addComponent(jLabel1, javax.swing.GroupLayout.PREFERRED_SIZE, 30, javax.swing.GroupLayout.PREFERRED_SIZE))
                        .addGap(18, 18, 18)
                        .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                            .addComponent(Actu1, javax.swing.GroupLayout.PREFERRED_SIZE, 50, javax.swing.GroupLayout.PREFERRED_SIZE)
                            .addComponent(btnEliminar, javax.swing.GroupLayout.PREFERRED_SIZE, 50, javax.swing.GroupLayout.PREFERRED_SIZE))
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED, 26, Short.MAX_VALUE)
                        .addComponent(jScrollPane1, javax.swing.GroupLayout.PREFERRED_SIZE, 270, javax.swing.GroupLayout.PREFERRED_SIZE))
                    .addGroup(layout.createSequentialGroup()
                        .addContainerGap(javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                        .addComponent(jLabel6, javax.swing.GroupLayout.PREFERRED_SIZE, 30, javax.swing.GroupLayout.PREFERRED_SIZE)
                        .addGap(18, 18, 18)
                        .addComponent(txtNombre, javax.swing.GroupLayout.PREFERRED_SIZE, 30, javax.swing.GroupLayout.PREFERRED_SIZE)
                        .addGap(18, 18, 18)
                        .addComponent(txtContra, javax.swing.GroupLayout.PREFERRED_SIZE, 30, javax.swing.GroupLayout.PREFERRED_SIZE)
                        .addGap(18, 18, 18)
                        .addComponent(txtRContra, javax.swing.GroupLayout.PREFERRED_SIZE, 30, javax.swing.GroupLayout.PREFERRED_SIZE)
                        .addGap(18, 18, 18)
                        .addComponent(txtTelefono, javax.swing.GroupLayout.PREFERRED_SIZE, 30, javax.swing.GroupLayout.PREFERRED_SIZE)
                        .addGap(18, 18, 18)
                        .addComponent(txtRfc, javax.swing.GroupLayout.PREFERRED_SIZE, 30, javax.swing.GroupLayout.PREFERRED_SIZE)
                        .addGap(18, 18, 18)
                        .addComponent(txtCurp, javax.swing.GroupLayout.PREFERRED_SIZE, 30, javax.swing.GroupLayout.PREFERRED_SIZE)
                        .addGap(18, 18, 18)
                        .addComponent(cmbRol, javax.swing.GroupLayout.PREFERRED_SIZE, 30, javax.swing.GroupLayout.PREFERRED_SIZE)
                        .addGap(18, 18, 18)
                        .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                            .addComponent(btnCancelar, javax.swing.GroupLayout.PREFERRED_SIZE, 50, javax.swing.GroupLayout.PREFERRED_SIZE)
                            .addComponent(btnGuardar, javax.swing.GroupLayout.PREFERRED_SIZE, 50, javax.swing.GroupLayout.PREFERRED_SIZE)
                            .addComponent(btnActualizar, javax.swing.GroupLayout.PREFERRED_SIZE, 50, javax.swing.GroupLayout.PREFERRED_SIZE))))
                .addContainerGap(25, Short.MAX_VALUE))
        );

        pack();
    }// </editor-fold>//GEN-END:initComponents
    
    private void llenarTabla(String nom){
        Tabla = (DefaultTableModel) tblUsuario.getModel();
        Object [] row = new Object[5];
        try{
            st = con.createStatement();
            String query = "SELECT PK_NombreU,roles_idRol,telefono,RFC,CURP FROM usuarios WHERE PK_NombreU like '"+nom+"%'";
            ResultSet rs = st.executeQuery(query);
            while(rs.next()){
                row[0] = rs.getString(1);
                row[1] = rs.getInt(2);
                row[2] = rs.getString(3);
                row[3] = rs.getString(4);
                row[4] = rs.getString(5);
                Tabla.addRow(row);
        }
        }catch (SQLException ex) {
            showMessageDialog(this, "Error: "+ex);
        }
    }
    
    private boolean validarContraseña(){
        if(!txtContra.getText().equals(txtRContra.getText()))return true;
        else return false;
    }
    
    private boolean validarVacios(){
        if(txtNombre.getText().equals("Nombre de usuario:") || txtContra.getText().equals("Contraseña:") || 
                txtRContra.getText().equals("Repetir contraseña:") || txtTelefono.getText().equals("Teléfono:") ||
                txtRfc.getText().equals("RFC:") || txtCurp.getText().equals("CURP:") ||
                cmbRol.getSelectedItem().equals("Seleccionar rol"))return true;
        else return false;
    }
    
    private boolean validarTelefono(){
        if(!txtTelefono.getText().matches("^\\d{12}$"))return true;
        else return false;
    }
    
    private boolean validarRFC(){
        if(!txtRfc.getText().matches("^([A-ZÑ\\x26]{3,4}([0-9]{2})(0[1-9]|1[0-2])(0[1-9]|1[0-9]|2[0-9]|3[0-1]))([A-Z\\d]{3})$"))return true;
        else return false;
    }
    
    private boolean validarCurp(){
        if(!txtCurp.getText().matches("^[A-Z]{1}[AEIOU]{1}[A-Z]{2}" +
        "[0-9]{2}(0[1-9]|1[0-2])(0[1-9]|1[0-9]|2[0-9]|3[0-1])" +
        "[HM]{1}" +
        "(AS|BC|BS|CC|CS|CH|CL|CM|DF|DG|GT|GR|HG|JC|MC|MN|MS|NT|NL|OC|PL|QT|QR|SP|SL|SR|TC|TS|TL|VZ|YN|ZS|NE)" +
        "[B-DF-HJ-NP-TV-Z]{3}" +
        "[0-9A-Z]{1}" +
        "[0-9]{1}$"))return true;
        else return false;
    }
    
    private void limpiarFormulario(){
        txtNombre.setText("Nombre de usuario:");
        txtNombre.setForeground(Color.gray);
        txtContra.setText("Contraseña:");
        txtContra.setForeground(Color.gray);
        txtRContra.setText("Repetir contraseña:");
        txtRContra.setForeground(Color.gray);
        txtTelefono.setText("Teléfono:");
        txtTelefono.setForeground(Color.gray);
        txtRfc.setText("RFC:");
        txtRfc.setForeground(Color.gray);
        txtCurp.setText("CURP:");
        txtCurp.setForeground(Color.gray);
        cmbRol.setSelectedIndex(0);
    }
    
    private void txtNombreFocusGained(java.awt.event.FocusEvent evt) {//GEN-FIRST:event_txtNombreFocusGained
        if(txtNombre.getText().equals("Nombre de usuario:")){
            txtNombre.setText("");
            txtNombre.setForeground(Color.black);
        }
    }//GEN-LAST:event_txtNombreFocusGained

    private void txtNombreFocusLost(java.awt.event.FocusEvent evt) {//GEN-FIRST:event_txtNombreFocusLost
        if(txtNombre.getText().equals("")){
            txtNombre.setText("Nombre de usuario:");
            txtNombre.setForeground(Color.gray);
        }
    }//GEN-LAST:event_txtNombreFocusLost

    private void txtContraFocusGained(java.awt.event.FocusEvent evt) {//GEN-FIRST:event_txtContraFocusGained
        if(txtContra.getText().equals("Contraseña:")){
            txtContra.setText("");
            txtContra.setForeground(Color.black);
        }
    }//GEN-LAST:event_txtContraFocusGained

    private void txtContraFocusLost(java.awt.event.FocusEvent evt) {//GEN-FIRST:event_txtContraFocusLost
        if(txtContra.getText().equals("")){
            txtContra.setText("Contraseña:");
            txtContra.setForeground(Color.gray);
        }
    }//GEN-LAST:event_txtContraFocusLost

    private void txtRContraFocusGained(java.awt.event.FocusEvent evt) {//GEN-FIRST:event_txtRContraFocusGained
        if(txtRContra.getText().equals("Repetir contraseña:")){
            txtRContra.setText("");
            txtRContra.setForeground(Color.black);
        }
    }//GEN-LAST:event_txtRContraFocusGained

    private void txtRContraFocusLost(java.awt.event.FocusEvent evt) {//GEN-FIRST:event_txtRContraFocusLost
        if(txtRContra.getText().equals("")){
            txtRContra.setText("Repetir contraseña:");
            txtRContra.setForeground(Color.gray);
        }
    }//GEN-LAST:event_txtRContraFocusLost

    private void txtTelefonoFocusGained(java.awt.event.FocusEvent evt) {//GEN-FIRST:event_txtTelefonoFocusGained
        if(txtTelefono.getText().equals("Teléfono:")){
            txtTelefono.setText("");
            txtTelefono.setForeground(Color.black);
        }
    }//GEN-LAST:event_txtTelefonoFocusGained

    private void txtTelefonoFocusLost(java.awt.event.FocusEvent evt) {//GEN-FIRST:event_txtTelefonoFocusLost
        if(txtTelefono.getText().equals("")){
            txtTelefono.setText("Teléfono:");
            txtTelefono.setForeground(Color.gray);
        }
    }//GEN-LAST:event_txtTelefonoFocusLost

    private void txtRfcFocusGained(java.awt.event.FocusEvent evt) {//GEN-FIRST:event_txtRfcFocusGained
        if(txtRfc.getText().equals("RFC:")){
            txtRfc.setText("");
            txtRfc.setForeground(Color.black);
        }
    }//GEN-LAST:event_txtRfcFocusGained

    private void txtRfcFocusLost(java.awt.event.FocusEvent evt) {//GEN-FIRST:event_txtRfcFocusLost
        if(txtRfc.getText().equals("")){
            txtRfc.setText("RFC:");
            txtRfc.setForeground(Color.gray);
        }
    }//GEN-LAST:event_txtRfcFocusLost

    private void txtCurpFocusGained(java.awt.event.FocusEvent evt) {//GEN-FIRST:event_txtCurpFocusGained
        if(txtCurp.getText().equals("CURP:")){
            txtCurp.setText("");
            txtCurp.setForeground(Color.black);
        }
    }//GEN-LAST:event_txtCurpFocusGained

    private void txtCurpFocusLost(java.awt.event.FocusEvent evt) {//GEN-FIRST:event_txtCurpFocusLost
        if(txtCurp.getText().equals("")){
            txtCurp.setText("CURP:");
            txtCurp.setForeground(Color.gray);
        }
    }//GEN-LAST:event_txtCurpFocusLost

    private void btnEliminarMouseClicked(java.awt.event.MouseEvent evt) {//GEN-FIRST:event_btnEliminarMouseClicked
        int fila = tblUsuario.getSelectedRow();
        if (fila < 0) {
            showMessageDialog(null, "No ha seleccionado un usuario");
        } else {
            String query = "DELETE FROM usuarios where PK_NombreU='"+tblUsuario.getValueAt(fila, 0).toString()+"'";
            RUD(query,this);
            vaciarTabla(Tabla, tblUsuario);
            llenarTabla("");
        }
    }//GEN-LAST:event_btnEliminarMouseClicked

    private void jLabel1MouseClicked(java.awt.event.MouseEvent evt) {//GEN-FIRST:event_jLabel1MouseClicked
        vaciarTabla(Tabla, tblUsuario);
        llenarTabla(txtBuscar.getText());
    }//GEN-LAST:event_jLabel1MouseClicked

    private void btnGuardarMouseClicked(java.awt.event.MouseEvent evt) {//GEN-FIRST:event_btnGuardarMouseClicked
        if(validarVacios())showMessageDialog(this, "Rellene todos los campos");
        else if(validarContraseña())showMessageDialog(this, "Las contraseñas no coinciden");
        else if(validarTelefono())showMessageDialog(this, "El teléfono no es correcto");
        else if(validarRFC())showMessageDialog(this, "El RFC no es correcto");
        else if(validarCurp())showMessageDialog(this, "La CURP no es correcta");
        else{
            String st_inserta = "INSERT INTO usuarios(PK_NombreU, contraseña_user, CURP, RFC, telefono, roles_idRol)"
                                 +"VALUES('"+txtNombre.getText()+"','"+txtContra.getText()+"','"+txtCurp.getText()
                                 +"','"+txtRfc.getText()+"','"+txtTelefono.getText()+"','"+(cmbRol.getSelectedIndex()+1)+"')";
            RUD(st_inserta,this);
            vaciarTabla(Tabla, tblUsuario);
            llenarTabla("");
            limpiarFormulario();
        }
    }//GEN-LAST:event_btnGuardarMouseClicked

    private void btnActualizarMouseClicked(java.awt.event.MouseEvent evt) {//GEN-FIRST:event_btnActualizarMouseClicked
        if(validarVacios())showMessageDialog(this, "Rellene todos los campos");
        else if(validarContraseña())showMessageDialog(this, "Las contraseñas no coinciden");
        else if(validarTelefono())showMessageDialog(this, "El teléfono no es correcto");
        else if(validarRFC())showMessageDialog(this, "El RFC no es correcto");
        else if(validarCurp())showMessageDialog(this, "La CURP no es correcta");
        else{
            try {
            String sql = "UPDATE usuarios SET PK_NombreU = ?, contraseña_user = ?, CURP = ?, RFC = ?, telefono = ?, roles_idRol = ? WHERE PK_NombreU = '"+nombreActualizar+"'";
            PreparedStatement pst = con.prepareStatement(sql);
            pst.setString(1, txtNombre.getText());
            pst.setString(2, txtContra.getText());
            pst.setString(3, txtCurp.getText());
            pst.setString(4, txtRfc.getText());
            pst.setString(5, txtTelefono.getText());
            pst.setInt(6, cmbRol.getSelectedIndex()+1);
            int n = pst.executeUpdate();
            if (n > 0) {
                showMessageDialog(this, "Usuario Actualizado");
                vaciarTabla(Tabla, tblUsuario);
                llenarTabla("");
                btnCancelar.setVisible(false);
                btnActualizar.setVisible(false);
                btnGuardar.setVisible(true);
                limpiarFormulario();
                
            } else {
                showMessageDialog(this, "Ocurrio un error al modificar");
            }
            } catch (SQLException e) {
                showMessageDialog(this, e);
            }
        }
        
    }//GEN-LAST:event_btnActualizarMouseClicked

    private void Actu1MouseClicked(java.awt.event.MouseEvent evt) {//GEN-FIRST:event_Actu1MouseClicked
        int fila = tblUsuario.getSelectedRow();
        if (fila < 0) {
            showMessageDialog(null, "Seleccione al usuario a actualizar");
        } else {
            btnCancelar.setVisible(true);
            btnActualizar.setVisible(true);
            btnGuardar.setVisible(false);
            try {
                st = con.createStatement();
                String query = "SELECT * FROM usuarios WHERE PK_NombreU= '"+tblUsuario.getValueAt(fila, 0).toString()+"'";
                ResultSet rs = st.executeQuery(query);
                while(rs.next()){
                    txtNombre.setText(rs.getString(1));
                    nombreActualizar=rs.getString(1);
                    txtContra.setText(rs.getString(2));
                    txtRContra.setText(rs.getString(2));
                    txtCurp.setText(rs.getString(3));
                    txtRfc.setText(rs.getString(4));
                    txtTelefono.setText(rs.getString(5));
                    cmbRol.setSelectedIndex(rs.getInt(6)-1);
                }
            } catch (SQLException ex) {
                Logger.getLogger(Usuarios.class.getName()).log(Level.SEVERE, null, ex);
            }
        }
    }//GEN-LAST:event_Actu1MouseClicked

    private void btnCancelarMouseClicked(java.awt.event.MouseEvent evt) {//GEN-FIRST:event_btnCancelarMouseClicked
        btnCancelar.setVisible(false);
        btnActualizar.setVisible(false);
        btnGuardar.setVisible(true);
        limpiarFormulario();
    }//GEN-LAST:event_btnCancelarMouseClicked

    /**
     * @param args the command line arguments
     */
    public static void main(String args[]) {
        /* Set the Nimbus look and feel */
        //<editor-fold defaultstate="collapsed" desc=" Look and feel setting code (optional) ">
        /* If Nimbus (introduced in Java SE 6) is not available, stay with the default look and feel.
         * For details see http://download.oracle.com/javase/tutorial/uiswing/lookandfeel/plaf.html 
         */
        try {
            for (javax.swing.UIManager.LookAndFeelInfo info : javax.swing.UIManager.getInstalledLookAndFeels()) {
                if ("Nimbus".equals(info.getName())) {
                    javax.swing.UIManager.setLookAndFeel(info.getClassName());
                    break;
                }
            }
        } catch (ClassNotFoundException ex) {
            java.util.logging.Logger.getLogger(Usuarios.class.getName()).log(java.util.logging.Level.SEVERE, null, ex);
        } catch (InstantiationException ex) {
            java.util.logging.Logger.getLogger(Usuarios.class.getName()).log(java.util.logging.Level.SEVERE, null, ex);
        } catch (IllegalAccessException ex) {
            java.util.logging.Logger.getLogger(Usuarios.class.getName()).log(java.util.logging.Level.SEVERE, null, ex);
        } catch (javax.swing.UnsupportedLookAndFeelException ex) {
            java.util.logging.Logger.getLogger(Usuarios.class.getName()).log(java.util.logging.Level.SEVERE, null, ex);
        }
        //</editor-fold>

        /* Create and display the form */
        java.awt.EventQueue.invokeLater(new Runnable() {
            public void run() {
                new Usuarios().setVisible(true);
            }
        });
    }

    // Variables declaration - do not modify//GEN-BEGIN:variables
    private javax.swing.JLabel Actu1;
    private javax.swing.JLabel btnActualizar;
    private javax.swing.JLabel btnCancelar;
    private javax.swing.JLabel btnEliminar;
    private javax.swing.JLabel btnGuardar;
    private javax.swing.JComboBox<String> cmbRol;
    private javax.swing.JLabel jLabel1;
    private javax.swing.JLabel jLabel2;
    private javax.swing.JLabel jLabel6;
    private javax.swing.JScrollPane jScrollPane1;
    private javax.swing.JTable tblUsuario;
    private javax.swing.JTextField txtBuscar;
    private javax.swing.JTextField txtContra;
    private javax.swing.JTextField txtCurp;
    private javax.swing.JTextField txtNombre;
    private javax.swing.JTextField txtRContra;
    private javax.swing.JTextField txtRfc;
    private javax.swing.JTextField txtTelefono;
    // End of variables declaration//GEN-END:variables
}
